name: ipsec_skillet1

label: IPSEC Config Skillet

description: |-

    Skillet Generated from 10.70.221.185 using network_pre_ipsec1.xml and

    ipsec_config_1.xml

type: panos

labels:

    collection: Unknown

variables:

-   name: tunnel_int_name
    description: tunnel_int_name
    type_hint: text
    default: ''

-   name: tunnel_desc
    description: tunnel_desc
    type_hint: text
    default: ''

-   name: gw_name
    description: gw_name
    type_hint: text
    default: ''

-   name: preshared_key
    description: preshared_key
    type_hint: text
    default: ''

-   name: local_int_address
    description: local_int_address
    type_hint: text
    default: ''

-   name: local_int
    description: local_int
    type_hint: text
    default: ''

-   name: nat_traversal
    description: nat_traversal
    type_hint: dropdown
    default: ''
    help_text: ''
    dd_list:
    -   key: 'Yes'
        value: 'yes'
    -   key: 'No'
        value: 'no'

-   name: passive_mode
    description: passive_mode
    type_hint: dropdown
    default: ''
    help_text: ''
    dd_list:
    -   key: 'Yes'
        value: 'yes'
    -   key: 'No'
        value: 'no'

-   name: peer_address
    description: peer_address
    type_hint: text
    default: ''

-   name: gw_desc
    description: gw_desc
    type_hint: text
    default: ''

-   name: ipsec_tunnel_name
    description: ipsec_tunnel_name
    type_hint: text
    default: ''

-   name: ipsec_tunnel_desc
    description: ipsec_tunnel_desc
    type_hint: text
    default: ''

-   name: vsys_name
    description: vsys_name
    type_hint: text
    default: ''

-   name: vrouter_name
    description: vrouter_name
    type_hint: text
    default: ''

-   name: static_route_name
    description: static_route_name
    type_hint: text
    default: ''

-   name: remote_network_ip
    description: remote_network_ip
    type_hint: text
    default: ''

-   name: tunnel_zone
    description: tunnel_zone
    type_hint: text
    default: ''

snippets:

-   name: tunnel-977376
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/interface
    element: |-
        <tunnel>
          <units>
            <entry name="{{ tunnel_int_name }}">
              <comment>{{ tunnel_desc }}</comment>
            </entry>
          </units>
        </tunnel>
    cmd: set

-   name: gateway-267147
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/ike
    element: |-
        <gateway>
          <entry name="{{ gw_name }}">
            <authentication>
              <pre-shared-key>
                <key>{{ preshared_key }}</key>
              </pre-shared-key>
            </authentication>
            <protocol>
              <ikev1>
                <dpd>
                  <enable>yes</enable>
                </dpd>
              </ikev1>
              <ikev2>
                <dpd>
                  <enable>yes</enable>
                </dpd>
              </ikev2>
            </protocol>
            <local-address>
              <ip>{{ local_int_address }}</ip>
              <interface>{{ local_int }}</interface>
            </local-address>
            <protocol-common>
              <nat-traversal>
                <enable>{{ nat_traversal }}</enable>
              </nat-traversal>
              <fragmentation>
                <enable>no</enable>
              </fragmentation>
              <passive-mode>{{ passive_mode }}</passive-mode>
            </protocol-common>
            <peer-address>
              <ip>{{ peer_address }}</ip>
            </peer-address>
            <comment>{{ gw_desc }}</comment>
          </entry>
        </gateway>
    cmd: set

-   name: tunnel-261490
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network
    element: |-
        <tunnel>
          <ipsec>
            <entry name="{{ ipsec_tunnel_name }}">
              <auto-key>
                <ike-gateway>
                  <entry name="{{ gw_name }}"/>
                </ike-gateway>
              </auto-key>
              <tunnel-monitor>
                <enable>no</enable>
              </tunnel-monitor>
              <tunnel-interface>{{ tunnel_int_name }}</tunnel-interface>
              <comment>{{ ipsec_tunnel_desc }}</comment>
              <disabled>no</disabled>
            </entry>
          </ipsec>
        </tunnel>
    cmd: set

-   name: member-106557
    xpath: /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="{{
        vsys_name }}"]/import/network/interface
    element: <member>{{ tunnel_int_name }}</member>
    cmd: set

-   name: member-688483
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/virtual-router/entry[@name="{{
        vrouter_name }}"]/interface
    element: <member>{{ tunnel_int_name }}</member>
    cmd: set

-   name: routing-table-883316
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/virtual-router/entry[@name="{{
        vrouter_name }}"]
    element: |-
        <routing-table>
          <ip>
            <static-route>
              <entry name="{{ static_route_name }}">
                <bfd>
                  <profile>None</profile>
                </bfd>
                <interface>{{ tunnel_int_name }}</interface>
                <metric>10</metric>
                <destination>{{ remote_network_ip }}</destination>
                <route-table>
                  <unicast/>
                </route-table>
              </entry>
            </static-route>
          </ip>
        </routing-table>
    cmd: set

-   name: member-990031
    xpath: /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="{{
        vsys_name }}"]/zone/entry[@name="{{ tunnel_zone }}"]/network/layer3
    element: <member>{{ tunnel_int_name }}</member>
    cmd: set

