name: ipsec_new_emily3

label: IPSEC Config Skillet New3

description: Skillet Generated from 10.70.221.185 using scott_before_1.xml and ipsec_config_1.xml

type: panos

labels:

    collection: Unknown

variables:

-   name: tunnel_name
    description: tunnel_name
    type_hint: text
    default: ''

-   name: tunnel_comment
    description: tunnel_comment
    type_hint: text
    default: ''

-   name: nat_traversal
    description: nat_traversal
    type_hint: dropdown
    default: ''
    help_text: ''
    dd_list:
    -   key: 'Yes'
        value: 'yes'
    -   key: 'No'
        value: 'no'

-   name: ike_gw_name
    description: ike_gw_name
    type_hint: text
    default: ''

-   name: passive_mode
    description: passive_mode
    type_hint: dropdown
    default: ''
    help_text: ''
    dd_list:
    -   key: 'Yes'
        value: 'yes'
    -   key: 'No'
        value: 'no'

-   name: local_ip_cidr
    description: local_ip_cidr
    type_hint: text
    default: ''

-   name: local_interface
    description: local_interface
    type_hint: text
    default: ''

-   name: peer_address
    description: peer_address
    type_hint: text
    default: ''

-   name: gw_comment
    description: gw_comment
    type_hint: text
    default: ''

-   name: preshared_key
    description: preshared_key
    type_hint: text
    default: ''

-   name: ipsec_tunnel_comment
    description: ipsec_tunnel_comment
    type_hint: text
    default: ''

-   name: ipsec_tunnel_name
    description: ipsec_tunnel_name
    type_hint: text
    default: ''

-   name: vsys
    description: vsys
    type_hint: text
    default: ''

-   name: vrouter
    description: vrouter
    type_hint: text
    default: ''

-   name: static_route_name
    description: static_route_name
    type_hint: text
    default: ''

-   name: dest_ip_cidr
    description: dest_ip_cidr
    type_hint: text
    default: ''

-   name: tunnel_zone
    description: tunnel_zone
    type_hint: text
    default: ''

snippets:

-   name: entry-489562
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/interface/tunnel/units
    element: |-
        <entry name="{{ tunnel_name }}">
          <comment>{{ tunnel_comment }}</comment>
        </entry>
    cmd: set

-   name: entry-755707
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/ike/gateway
    element: |-
        <entry name="{{ ike_gw_name }}">
          <authentication>
            <pre-shared-key>
              <key>{{ preshared_key }}</key>
            </pre-shared-key>
          </authentication>
          <protocol>
            <ikev1>
              <dpd>
                <enable>yes</enable>
              </dpd>
            </ikev1>
            <ikev2>
              <dpd>
                <enable>yes</enable>
              </dpd>
            </ikev2>
          </protocol>
          <local-address>
            <ip>{{ local_ip_cidr }}</ip>
            <interface>{{ local_interface }}</interface>
          </local-address>
          <protocol-common>
            <nat-traversal>
              <enable>{{ nat_traversal }}</enable>
            </nat-traversal>
            <fragmentation>
              <enable>no</enable>
            </fragmentation>
            <passive-mode>{{ passive_mode }}</passive-mode>
          </protocol-common>
          <peer-address>
            <ip>{{ peer_address }}</ip>
          </peer-address>
          <comment>{{ gw_comment }}</comment>
        </entry>
    cmd: set

-   name: entry-545373
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/tunnel/ipsec
    element: |-
        <entry name="{{ ipsec_tunnel_name }}">
          <auto-key>
            <ike-gateway>
              <entry name="{{ ike_gw_name }}"/>
            </ike-gateway>
          </auto-key>
          <tunnel-monitor>
            <enable>no</enable>
          </tunnel-monitor>
          <tunnel-interface>{{ tunnel_name }}</tunnel-interface>
          <comment>{{ ipsec_tunnel_comment }}</comment>
          <disabled>no</disabled>
        </entry>
    cmd: set

-   name: member-716531
    xpath: /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="{{
        vsys }}"]/import/network/interface
    element: <member>{{ tunnel_name }}</member>
    cmd: set

-   name: member-543096
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/virtual-router/entry[@name="{{
        vrouter }}"]/interface
    element: <member>{{ tunnel_name }}</member>
    cmd: set

-   name: entry-500416
    xpath: /config/devices/entry[@name="localhost.localdomain"]/network/virtual-router/entry[@name="{{
        vrouter }}"]/routing-table/ip/static-route
    element: |-
        <entry name="{{ static_route_name }}">
          <bfd>
            <profile>None</profile>
          </bfd>
          <interface>{{ tunnel_name }}</interface>
          <metric>10</metric>
          <destination>{{ dest_ip_cidr }}</destination>
          <route-table>
            <unicast/>
          </route-table>
        </entry>
    cmd: set

-   name: member-443242
    xpath: /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="{{
        vsys }}"]/zone/entry[@name="{{ tunnel_zone }}"]/network/layer3
    element: <member>{{ tunnel_name }}</member>
    cmd: set

